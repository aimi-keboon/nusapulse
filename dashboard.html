<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthScreen - Metabolic Age Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #333;
        }

        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4facfe;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
        }

        .nav-menu a {
            text-decoration: none;
            color: #666;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            color: #4facfe;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            font-weight: 500;
            color: #333;
        }

        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #ff5252;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .welcome-section {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .welcome-title {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .metabolic-age-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .age-comparison {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .age-item {
            text-align: center;
        }

        .age-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 5px;
        }

        .age-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .chronological-age {
            color: #64748b;
        }

        .metabolic-age {
            color: #ef4444;
        }

        .age-better {
            color: #22c55e;
        }

        .age-difference {
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .age-difference.better {
            background: #22c55e;
        }

        .horizontal-meter {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 80px;
            margin: 20px auto;
            background: #f1f5f9;
            border-radius: 40px;
            padding: 8px;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.1);
        }

        .age-track {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, 
                #22c55e 0%, #22c55e 25%,
                #84cc16 25%, #84cc16 45%,
                #f59e0b 45%, #f59e0b 65%,
                #ef4444 65%, #ef4444 85%,
                #dc2626 85%, #dc2626 100%);
            border-radius: 32px;
            overflow: hidden;
        }

        .age-slider {
            position: absolute;
            top: 50%;
            left: 150px;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            cursor: grab;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 3px solid #e5e7eb;
            z-index: 10;
        }

        .age-slider:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transform: translate(-50%, -50%) scale(1.05);
        }

        .slider-icon {
            width: 28px;
            height: 28px;
            margin-bottom: 2px;
        }

        .slider-age {
            font-size: 0.75rem;
            font-weight: bold;
            color: #374151;
        }

        .age-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 0 35px;
        }

        .label-item {
            text-align: center;
            font-size: 0.8rem;
            color: #64748b;
        }

        .label-age {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .improvement-message {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            text-align: left;
            border-left: 4px solid #3b82f6;
        }

        .message-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .message-content {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .metrics-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .metric-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }

        .metric-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .metric-item.critical { border-left-color: #ef4444; }
        .metric-item.high { border-left-color: #f59e0b; }
        .metric-item.medium { border-left-color: #3b82f6; }

        .metric-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .metric-text {
            flex: 1;
        }

        .metric-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .metric-desc {
            font-size: 0.8rem;
            color: #64748b;
            line-height: 1.3;
        }

        .metric-impact {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
            white-space: nowrap;
        }

        .metric-impact.critical { background: #ef4444; }
        .metric-impact.high { background: #f59e0b; }
        .metric-impact.medium { background: #3b82f6; }

        .quick-actions {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .quick-actions h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .action-btn {
            background: #f1f5f9;
            border: 2px solid transparent;
            padding: 20px;
            border-radius: 12px;
            text-decoration: none;
            color: #333;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .action-btn:hover {
            border-color: #4facfe;
            background: #eff6ff;
            transform: translateY(-2px);
        }

        .action-btn-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .metabolic-factors {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            grid-column: 1 / -1;
        }

        .factors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .factor-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid;
        }

        .factor-item.excellent { border-left-color: #22c55e; }
        .factor-item.good { border-left-color: #84cc16; }
        .factor-item.fair { border-left-color: #f59e0b; }
        .factor-item.poor { border-left-color: #ef4444; }
        .factor-item.unknown { border-left-color: #94a3b8; }

        .factor-name {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }

        .factor-value {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .factor-impact {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 5px;
        }

        .factor-status {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .nav-menu {
                display: none;
            }
            
            .factors-grid {
                grid-template-columns: 1fr;
            }

            .horizontal-meter {
                max-width: 300px;
                height: 70px;
            }

            .age-slider {
                width: 60px;
                height: 60px;
            }

            .slider-icon {
                width: 24px;
                height: 24px;
            }

            .slider-age {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">üè• HealthScreen</div>
            <div class="nav-menu">
                <a href="dashboard.html" class="active">Dashboard</a>
                <a href="upload.html">Upload Files</a>
                <a href="history.html">Health History</a>
                <a href="profile.html">Profile</a>
            </div>
            <div class="user-menu">
                <span class="user-info" id="userName">Loading...</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title">Welcome back, <span id="welcomeName">User</span>!</h1>
            <p class="welcome-subtitle">Discover how to reverse your metabolic age and optimize your health</p>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Metabolic Age Slider -->
            <div class="metabolic-age-card">
                <h3 style="margin-bottom: 15px;">üß¨ Metabolic Age Explorer</h3>
                
                <div class="age-comparison">
                    <div class="age-item">
                        <div class="age-label">Your Age</div>
                        <div class="age-value chronological-age" id="chronologicalAge">33</div>
                        <div style="font-size: 0.8rem; color: #64748b;">Chronological</div>
                    </div>
                    <div class="age-difference" id="ageDifference">+9 years</div>
                    <div class="age-item">
                        <div class="age-label">Metabolic Age</div>
                        <div class="age-value metabolic-age" id="metabolicAge">42</div>
                        <div style="font-size: 0.8rem; color: #64748b;">Based on health data</div>
                    </div>
                </div>

                <p style="color: #666; margin-bottom: 20px; font-size: 0.9rem; text-align: center;">
                    Drag the slider to see what improvements can reduce your metabolic age
                </p>
                
                <div class="horizontal-meter">
                    <div class="age-track">
                        <div class="age-slider" id="ageSlider">
                            <svg class="slider-icon" id="ageIcon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#ef4444"/>
                            </svg>
                            <div class="slider-age" id="sliderAge">42</div>
                        </div>
                    </div>
                    <div class="age-labels">
                        <div class="label-item">
                            <div class="label-age">20</div>
                            <div>Optimal</div>
                        </div>
                        <div class="label-item">
                            <div class="label-age">30</div>
                            <div>Good</div>
                        </div>
                        <div class="label-item">
                            <div class="label-age">40</div>
                            <div>Fair</div>
                        </div>
                        <div class="label-item">
                            <div class="label-age">50</div>
                            <div>Poor</div>
                        </div>
                        <div class="label-item">
                            <div class="label-age">60+</div>
                            <div>Critical</div>
                        </div>
                    </div>
                </div>

                <div class="improvement-message" id="improvementMessage">
                    <div class="message-title" id="messageTitle">Your Current Metabolic Age</div>
                    <div class="message-content" id="messageContent">Your metabolic age is 9 years older than your chronological age. Drag the slider left to see what improvements can help!</div>
                    <div class="metrics-list" id="metricsList">
                        <!-- Dynamic metrics will appear here -->
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <a href="upload.html" class="action-btn">
                        <span class="action-btn-icon">üìÑ</span>
                        Upload Report
                    </a>
                    <a href="history.html" class="action-btn">
                        <span class="action-btn-icon">üìä</span>
                        View History
                    </a>
                    <a href="#" class="action-btn" onclick="scheduleCheckup()">
                        <span class="action-btn-icon">üìÖ</span>
                        Schedule Checkup
                    </a>
                    <a href="profile.html" class="action-btn">
                        <span class="action-btn-icon">‚öôÔ∏è</span>
                        Update Profile
                    </a>
                </div>
            </div>
        </div>

        <!-- Metabolic Factors -->
        <div class="metabolic-factors">
            <h3 style="margin-bottom: 25px;">Key Metabolic Age Factors</h3>
            <div class="factors-grid" id="factorsGrid">
                <!-- Factors will be loaded dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Age status SVG icons
        const ageIcons = {
            excellent: '<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="#22c55e"/>',
            good: '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="#84cc16"/>',
            fair: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#f59e0b"/>',
            poor: '<path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" fill="#ef4444"/>',
            critical: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#dc2626"/>'
        };

        // Metabolic age improvement strategies
        const ageImprovements = {
            20: {
    title: "üåü Optimal Metabolic Health",
    message: "Your metabolic age is exceptional! Focus on maintaining these excellent habits:",
    metrics: [
        { title: "Maintain Muscle Mass", desc: "Continue strength training 3-4x per week", impact: "medium" },
        { title: "Optimal Nutrition", desc: "Keep nutrient-dense, anti-inflammatory diet", impact: "medium" },
        { title: "Stress Management", desc: "Continue meditation and recovery practices", impact: "medium" }
    ]
},
30: {
    title: "‚úÖ Good Metabolic Health",
    message: "You're doing well! These optimizations will get you to optimal metabolic age:",
    metrics: [
        { title: "Increase Protein Intake", desc: "Aim for 1.6-2.2g per kg body weight daily", impact: "high" },
        { title: "Resistance Training", desc: "Add 2-3 strength training sessions per week", impact: "high" },
        { title: "Improve Sleep Quality", desc: "Optimize for 7-9 hours of deep sleep", impact: "medium" }
    ]
},
40: {
    title: "üìà Fair Metabolic Health - Improvement Needed",
    message: "Your metabolic age needs attention. Focus on these key areas to reverse aging:",
    metrics: [
        { title: "Fix Insulin Resistance", desc: "Reduce refined carbs, increase fiber to 35g+ daily", impact: "critical" },
        { title: "Build Muscle Mass", desc: "Start progressive resistance training program", impact: "critical" },
        { title: "Reduce Inflammation", desc: "Eliminate processed foods, add omega-3s", impact: "high" },
        { title: "Intermittent Fasting", desc: "Try 16:8 fasting to improve metabolic flexibility", impact: "high" }
    ]
},
50: {
    title: "‚ö†Ô∏è Poor Metabolic Health - Action Required",
    message: "Multiple metabolic issues are aging you rapidly. These changes are critical:",
    metrics: [
        { title: "Address Metabolic Syndrome", desc: "Work with doctor on blood sugar, BP, cholesterol", impact: "critical" },
        { title: "Lose Visceral Fat", desc: "Combine caloric deficit with strength training", impact: "critical" },
        { title: "Drastically Reduce Sugar", desc: "Eliminate all added sugars and refined carbs", impact: "critical" },
        { title: "Increase Daily Activity", desc: "Walk 10,000+ steps, add movement every hour", impact: "high" }
    ]
},
60: {
    title: "üö® Critical Metabolic Health",
    message: "Your metabolic age indicates severe health risks. Immediate intervention needed:",
    metrics: [
        { title: "Medical Intervention", desc: "Immediate doctor consultation for metabolic panel", impact: "critical" },
        { title: "Comprehensive Diet Overhaul", desc: "Work with nutritionist on metabolic reset plan", impact: "critical" },
        { title: "Supervised Exercise Program", desc: "Start with medical clearance and supervision", impact: "critical" },
        { title: "Sleep Disorder Treatment", desc: "Address sleep apnea and poor sleep quality", impact: "critical" }
    ]
}

        };

        // Sample user data
        const userData = {
            user: { firstName: "John", lastName: "Doe" },
            chronologicalAge: 33,
            metabolicAge: 42,
            factors: [
                { name: "Muscle Mass", value: "Below Average", impact: "Ages you +5 years", status: "poor" },
                { name: "Visceral Fat", value: "18%", impact: "Ages you +3 years", status: "fair" },
                { name: "Insulin Sensitivity", value: "Resistant", impact: "Ages you +7 years", status: "poor" },
                { name: "VO2 Max", value: "32 ml/kg/min", impact: "Ages you +2 years", status: "fair" },
                { name: "Inflammation (CRP)", value: "4.2 mg/L", impact: "Ages you +4 years", status: "poor" },
                { name: "Sleep Quality", value: "5.5 hrs avg", impact: "Ages you +3 years", status: "fair" },
                { name: "Stress (Cortisol)", value: "Elevated", impact: "Ages you +2 years", status: "fair" },
                { name: "RMR (Metabolism)", value: "1,680 cal/day", impact: "Ages you +1 year", status: "good" }
            ]
        };

        // Global variables
        let currentMetabolicAge = 42;
        let chronologicalAge = 33;
        let isDragging = false;
        let sliderMinX = 0;
        let sliderMaxX = 0;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const token = localStorage.getItem('healthscreen_token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            loadUserData();
            loadMetabolicFactors();
            initializeAgeSlider();
        });

        function loadUserData() {
            const user = JSON.parse(localStorage.getItem('healthscreen_user')) || userData.user;
            document.getElementById('userName').textContent = `${user.firstName} ${user.lastName}`;
            document.getElementById('welcomeName').textContent = user.firstName;
            
            // Set age values
            document.getElementById('chronologicalAge').textContent = chronologicalAge;
            document.getElementById('metabolicAge').textContent = currentMetabolicAge;
            
            // Calculate and display age difference
            updateAgeDifference();
        }

       function updateAgeDifference() {
    const difference = currentMetabolicAge - chronologicalAge;
    const diffElement = document.getElementById('ageDifference');
    const metabolicAgeElement = document.getElementById('metabolicAge');

    const absDiff = Math.abs(difference).toFixed(1);
    const unit = (absDiff == 1.0 ? "year" : "years");

    if (difference > 0) {
        diffElement.textContent = `${absDiff} ${unit} older`;
        diffElement.className = 'age-difference';
        metabolicAgeElement.className = 'age-value metabolic-age';
    } else if (difference < 0) {
        diffElement.textContent = `${absDiff} ${unit} younger`;
        diffElement.className = 'age-difference better';
        metabolicAgeElement.className = 'age-value age-better';
    } else {
        diffElement.textContent = 'Same age';
        diffElement.className = 'age-difference better';
        metabolicAgeElement.className = 'age-value age-better';
    }
}


        function loadMetabolicFactors() {
            const container = document.getElementById('factorsGrid');
            container.innerHTML = '';

            userData.factors.forEach(factor => {
                const factorElement = document.createElement('div');
                factorElement.className = `factor-item ${factor.status}`;
                
                factorElement.innerHTML = `
                    <div class="factor-name">${factor.name}</div>
                    <div class="factor-value">${factor.value}</div>
                    <div class="factor-impact">${factor.impact}</div>
                    <div class="factor-status">${factor.status}</div>
                `;
                container.appendChild(factorElement);
            });
        }

        function initializeAgeSlider() {
            const slider = document.getElementById('ageSlider');
            const track = slider.parentElement;
            
            // Calculate boundaries (age range 20-65)
            const trackRect = track.getBoundingClientRect();
            sliderMinX = 35; // Padding from left
            sliderMaxX = trackRect.width - 35; // Padding from right
            
            // Set initial position
            updateSliderPosition(currentMetabolicAge);
            updateSliderAppearance(currentMetabolicAge);
            updateImprovementMessage(currentMetabolicAge);

            // Add event listeners
            slider.addEventListener('mousedown', startDragging);
            slider.addEventListener('touchstart', startDragging);
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('mouseup', stopDragging);
            document.addEventListener('touchend', stopDragging);

            // Prevent default drag behavior
            slider.addEventListener('dragstart', e => e.preventDefault());
        }

        function startDragging(e) {
            isDragging = true;
            e.preventDefault();
        }

        function drag(e) {
    if (!isDragging) return;

    const track = document.getElementById('ageSlider').parentElement;
    const trackRect = track.getBoundingClientRect();
    
    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    let x = clientX - trackRect.left;
    
    // Keep within bounds
    x = Math.max(sliderMinX, Math.min(x, sliderMaxX));
    
    // Convert position to age (20-65 range)
    const age = 20 + ((x - sliderMinX) / (sliderMaxX - sliderMinX)) * 45;
    
    // Allow full range movement
    updateSliderPosition(age);
    updateSliderAppearance(age);
    updateImprovementMessage(age);
    updateDisplayedAge(age);
}


        function stopDragging() {
            isDragging = false;
        }

        function updateSliderPosition(age) {
            const slider = document.getElementById('ageSlider');
            // Map age 20-65 to position
            const agePercent = (age - 20) / 45;
            const position = sliderMinX + (agePercent * (sliderMaxX - sliderMinX));
            
            slider.style.left = position + 'px';
            document.getElementById('sliderAge').textContent = Math.round(age);
        }

        function updateSliderAppearance(age) {
            const slider = document.getElementById('ageSlider');
            const icon = document.getElementById('ageIcon');
            
            let category, iconSvg, borderColor;
            
            if (age <= 25) {
                category = 'excellent';
                iconSvg = ageIcons.excellent;
                borderColor = '#22c55e';
            } else if (age <= 35) {
                category = 'good';
                iconSvg = ageIcons.good;
                borderColor = '#84cc16';
            } else if (age <= 45) {
                category = 'fair';
                iconSvg = ageIcons.fair;
                borderColor = '#f59e0b';
            } else if (age <= 55) {
                category = 'poor';
                iconSvg = ageIcons.poor;
                borderColor = '#ef4444';
            } else {
                category = 'critical';
                iconSvg = ageIcons.critical;
                borderColor = '#dc2626';
            }

            icon.innerHTML = iconSvg;
            slider.style.borderColor = borderColor;
        }

        function updateDisplayedAge(age) {
            document.getElementById('metabolicAge').textContent = Math.round(age);
            currentMetabolicAge = age;
            updateAgeDifference();
        }

        function updateImprovementMessage(targetAge) {
            const messageTitle = document.getElementById('messageTitle');
            const messageContent = document.getElementById('messageContent');
            const metricsList = document.getElementById('metricsList');

            // Find the appropriate improvement range
            let improvementKey = 60;
            if (targetAge <= 25) improvementKey = 20;
            else if (targetAge <= 35) improvementKey = 30;
            else if (targetAge <= 45) improvementKey = 40;
            else if (targetAge <= 55) improvementKey = 50;

            const improvement = ageImprovements[improvementKey];

            if (Math.abs(targetAge - 42) < 1) {
                // At current metabolic age
                messageTitle.textContent = "Your Current Metabolic Age";
                messageContent.textContent = `Your metabolic age is ${Math.round(targetAge - chronologicalAge)} years older than your chronological age. Drag the slider left to see what improvements can help reverse this!`;
                metricsList.innerHTML = '';
            } else {
                // Showing improvement path
                const ageReduction = Math.round(42 - targetAge);
                messageTitle.textContent = `To reach age ${Math.round(targetAge)}: ${improvement.title}`;
                messageContent.textContent = improvement.message;
                
                // Show specific metabolic improvements
metricsList.innerHTML = improvement.metrics.map(metric => {
    const sign = ageReduction >= 0 ? "-" : "+";
    return `
        <div class="metric-item ${metric.impact}">
            <svg class="metric-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="${metric.icon}"/>
            </svg>
            <div class="metric-text">
                <div class="metric-title">${metric.title}</div>
                <div class="metric-desc">${metric.desc}</div>
            </div>
            <span class="metric-impact ${metric.impact}">${sign}${Math.abs(ageReduction)} years</span>
        </div>
    `;
}).join('');

            }
        }

        function scheduleCheckup() {
            alert('Metabolic age assessment scheduling will be available soon! Please contact our support team.');
        }

        function logout() {
            localStorage.removeItem('healthscreen_token');
            localStorage.removeItem('healthscreen_user');
            window.location.href = 'login.html';
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            const track = document.getElementById('ageSlider').parentElement;
            const trackRect = track.getBoundingClientRect();
            sliderMinX = 35;
            sliderMaxX = trackRect.width - 35;
            updateSliderPosition(currentMetabolicAge);
        });
    </script>
</body>
</html>